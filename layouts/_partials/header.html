<header class="border-b border-[rgb(var(--border))] bg-[rgb(var(--bg))]">
  <div class="mx-auto max-w-3xl px-6 py-6 flex items-center justify-between gap-4">
    <a href="/" class="flex items-center gap-1.5 md:gap-2">
      {{ with .Site.Params.logo }}
        <img src="{{ . }}" alt="" class="w-5 h-5 md:w-6 md:h-6">
      {{ end }}
      <span class="font-semibold tracking-tight text-base md:text-lg">{{ .Site.Title }}</span>
    </a>

    <div class="flex items-center gap-3">
      <nav class="text-sm md:text-base text-[rgb(var(--muted))] flex gap-3">
        {{ range .Site.Menus.main }}
          {{ $active := or ($.IsMenuCurrent "main" .) ($.HasMenuCurrent "main" .) }}
          {{ if .HasChildren }}
            <div class="relative group">
              <a href="{{ .URL }}" class="hover:text-[rgb(var(--fg))] {{ if $active }}text-[rgb(var(--fg))] font-medium{{ end }}">
                {{ .Name }}
                <svg class="w-3 h-3 inline-block ml-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </a>
              <div class="absolute hidden group-hover:block min-w-max">
                <div class="h-3 w-full"></div>
                <div class="bg-[rgb(var(--bg))] border border-[rgb(var(--fg-muted))] py-1">
                  {{ range .Children }}
                    {{ $childActive := eq $.RelPermalink .URL }}
                    <a href="{{ .URL }}" class="block px-4 py-1 hover:text-[rgb(var(--fg))] {{ if $childActive }}text-[rgb(var(--fg))] font-medium{{ end }}">
                      {{ .Name }}
                    </a>
                  {{ end }}
                </div>
              </div>
            </div>
          {{ else }}
            <a href="{{ .URL }}" class="hover:text-[rgb(var(--fg))] {{ if $active }}text-[rgb(var(--fg))] font-medium{{ end }}">
              {{ .Name }}
            </a>
          {{ end }}
        {{ end }}
      </nav>

      {{/* App Provenance Badge with Dropdown */}}
      {{ $rel := .Site.Data.release }}
      {{ $container := index $rel.components 0 }}
      <div class="relative" data-dropdown>
        <button data-dropdown-toggle class="text-xs rounded-full border border-[rgb(var(--border))] bg-[rgb(var(--panel))] px-3 py-1.5 flex items-center gap-2 hover:border-[rgb(var(--accent))] transition-colors cursor-pointer">
          {{ if eq $rel.vulnerabilities.summary.critical 0 }}
            <span class="status-dot"></span>
          {{ else }}
            <span class="status-dot status-dot--bad"></span>
          {{ end }}
          <span class="font-medium">v{{ $rel.version }}</span>
          <span class="text-[rgb(var(--muted))] mono text-[10px]">{{ $rel.source.commit_short }}</span>
          <svg class="w-3 h-3 text-[rgb(var(--muted))] transition-transform [.open_&]:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

        {{/* Dropdown Panel */}}
        <div class="absolute right-0 mt-2 w-80 rounded-lg border border-[rgb(var(--border))] bg-[rgb(var(--panel))] shadow-lg z-50 hidden [.open_&]:block">
          <div class="p-4 space-y-4">
            <div class="text-xs font-medium text-[rgb(var(--fg))] uppercase tracking-wide">App Provenance</div>

            {{/* Build Info */}}
            <div class="grid grid-cols-2 gap-2 text-xs">
              <div>
                <div class="text-[rgb(var(--muted))]">Version</div>
                <div class="mono">{{ $rel.version }}</div>
              </div>
              <div>
                <div class="text-[rgb(var(--muted))]">Build ID</div>
                <div class="mono text-[10px]">{{ $rel.build_id }}</div>
              </div>
              <div>
                <div class="text-[rgb(var(--muted))]">Track</div>
                <div class="mono">{{ $rel.track }}</div>
              </div>
              <div>
                <div class="text-[rgb(var(--muted))]">Built</div>
                <div class="mono text-[10px]">{{ $rel.created_at | time.Format "2006-01-02" }}</div>
              </div>
            </div>

            {{/* Source Info */}}
            <div class="border-t border-[rgb(var(--border))] pt-3">
              <div class="text-[10px] font-medium text-[rgb(var(--muted))] uppercase tracking-wide mb-2">Source</div>
              <div class="grid grid-cols-2 gap-2 text-xs">
                <div>
                  <div class="text-[rgb(var(--muted))]">Commit</div>
                  <div class="mono flex items-center gap-1">
                    {{ $rel.source.commit_short }}
                    {{ if $rel.source.dirty }}
                      <span class="text-[rgb(var(--warn))]">*</span>
                    {{ end }}
                  </div>
                </div>
                <div>
                  <div class="text-[rgb(var(--muted))]">Date</div>
                  <div class="mono text-[10px]">{{ $rel.source.commit_date | time.Format "2006-01-02" }}</div>
                </div>
              </div>
            </div>

            {{/* Attestations */}}
            <div class="border-t border-[rgb(var(--border))] pt-3">
              <div class="text-[10px] font-medium text-[rgb(var(--muted))] uppercase tracking-wide mb-2">Attestations</div>
              <div class="grid grid-cols-2 gap-2 text-xs">
                <div class="flex items-center gap-1.5">
                  {{ if $rel.attestations.cosign.signed }}
                    <span class="w-2 h-2 rounded-full bg-[rgb(var(--good))]"></span>
                  {{ else }}
                    <span class="w-2 h-2 rounded-full bg-[rgb(var(--bad))]"></span>
                  {{ end }}
                  <span>Cosign Signature</span>
                </div>
                <div class="flex items-center gap-1.5">
                  {{ if $rel.attestations.slsa.verified }}
                    <span class="w-2 h-2 rounded-full bg-[rgb(var(--good))]"></span>
                  {{ else }}
                    <span class="w-2 h-2 rounded-full bg-[rgb(var(--bad))]"></span>
                  {{ end }}
                  <span>SLSA L{{ $rel.attestations.slsa.level }}</span>
                </div>
              </div>
            </div>

            {{/* Policy Requirements */}}
            <div class="border-t border-[rgb(var(--border))] pt-3">
              <div class="text-[10px] font-medium text-[rgb(var(--muted))] uppercase tracking-wide mb-2">Policy</div>
              <div class="grid grid-cols-2 gap-1.5 text-[10px]">
                <div class="flex items-center gap-1.5">
                  {{ if $rel.policy.defaults.signing.require_signature }}
                    <span class="w-1.5 h-1.5 rounded-full bg-[rgb(var(--good))]"></span>
                  {{ else }}
                    <span class="w-1.5 h-1.5 rounded-full bg-[rgb(var(--muted))]"></span>
                  {{ end }}
                  <span>Signing required</span>
                </div>
                <div class="flex items-center gap-1.5">
                  {{ if $rel.policy.defaults.evidence.sbom.required }}
                    <span class="w-1.5 h-1.5 rounded-full bg-[rgb(var(--good))]"></span>
                  {{ else }}
                    <span class="w-1.5 h-1.5 rounded-full bg-[rgb(var(--muted))]"></span>
                  {{ end }}
                  <span>SBOM required</span>
                </div>
                <div class="flex items-center gap-1.5">
                  {{ if $rel.policy.defaults.evidence.scan.required }}
                    <span class="w-1.5 h-1.5 rounded-full bg-[rgb(var(--good))]"></span>
                  {{ else }}
                    <span class="w-1.5 h-1.5 rounded-full bg-[rgb(var(--muted))]"></span>
                  {{ end }}
                  <span>Scan required</span>
                </div>
                <div class="flex items-center gap-1.5">
                  {{ if $rel.policy.defaults.vulnerability.gating.block_on }}
                    <span class="w-1.5 h-1.5 rounded-full bg-[rgb(var(--good))]"></span>
                  {{ else }}
                    <span class="w-1.5 h-1.5 rounded-full bg-[rgb(var(--muted))]"></span>
                  {{ end }}
                  <span>Vuln gating</span>
                </div>
              </div>
            </div>

            {{/* Vulnerability Summary */}}
            <div class="border-t border-[rgb(var(--border))] pt-3">
              <div class="text-[10px] font-medium text-[rgb(var(--muted))] uppercase tracking-wide mb-2">Vulnerabilities</div>
              <div class="flex gap-3 text-xs">
                <div class="flex items-center gap-1">
                  <span class="w-5 h-5 rounded flex items-center justify-center bg-[rgb(var(--bad))]/20 text-[rgb(var(--bad))] font-medium">{{ $rel.vulnerabilities.summary.critical }}</span>
                  <span class="text-[rgb(var(--muted))]">C</span>
                </div>
                <div class="flex items-center gap-1">
                  <span class="w-5 h-5 rounded flex items-center justify-center bg-[rgb(var(--warn))]/20 text-[rgb(var(--warn))] font-medium">{{ $rel.vulnerabilities.summary.high }}</span>
                  <span class="text-[rgb(var(--muted))]">H</span>
                </div>
                <div class="flex items-center gap-1">
                  <span class="w-5 h-5 rounded flex items-center justify-center bg-[rgb(var(--accent))]/20 text-[rgb(var(--accent))] font-medium">{{ $rel.vulnerabilities.summary.medium }}</span>
                  <span class="text-[rgb(var(--muted))]">M</span>
                </div>
                <div class="flex items-center gap-1">
                  <span class="w-5 h-5 rounded flex items-center justify-center bg-[rgb(var(--muted))]/20 text-[rgb(var(--muted))] font-medium">{{ $rel.vulnerabilities.summary.low }}</span>
                  <span class="text-[rgb(var(--muted))]">L</span>
                </div>
              </div>
            </div>

            {{/* Container Info */}}
            <div class="border-t border-[rgb(var(--border))] pt-3 text-xs">
              <div class="text-[rgb(var(--muted))]">Container</div>
              <div class="mono text-[10px] break-all">{{ $container.index.registry }}/{{ $container.index.repository }}:{{ $container.index.tag }}</div>
              <div class="mono text-[10px] text-[rgb(var(--muted))] break-all mt-1">{{ printf "%.24s" $container.index.digest }}...</div>
              <div class="text-[rgb(var(--muted))] mt-1">Pushed: {{ $container.index.pushed_at | time.Format "2006-01-02 15:04" }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
